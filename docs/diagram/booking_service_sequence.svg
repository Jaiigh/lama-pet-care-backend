<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1675px" preserveAspectRatio="none" style="width:1966px;height:1675px;background:#FFFFFF;" version="1.1" viewBox="0 0 1966 1675" width="1966px" zoomAndPan="magnify"><title>Booking Service &#8212; simplified flow</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="245.7178" x="856.3093" y="28.5352">Booking Service &#8212; simplified flow</text><rect fill="none" height="90.8867" style="stroke:#000000;stroke-width:1.5;" width="627.8135" x="1321.5229" y="1363.0195"/><g><title>Owner</title><rect fill="#000000" fill-opacity="0.00000" height="1475.1719" width="8" x="25.9399" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="29" x2="29" y1="118.9766" y2="1594.1484"/></g><g><title>Frontend</title><rect fill="#000000" fill-opacity="0.00000" height="1475.1719" width="8" x="297.1875" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="300.4063" x2="300.4063" y1="118.9766" y2="1594.1484"/></g><g><title>HTTP API</title><rect fill="#000000" fill-opacity="0.00000" height="1475.1719" width="8" x="839.0166" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="842.2393" x2="842.2393" y1="118.9766" y2="1594.1484"/></g><g><title>ServiceService</title><rect fill="#000000" fill-opacity="0.00000" height="1475.1719" width="8" x="1381.855" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1385.5229" x2="1385.5229" y1="118.9766" y2="1594.1484"/></g><g><title>PaymentService</title><rect fill="#000000" fill-opacity="0.00000" height="1475.1719" width="8" x="1505.6426" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1509.187" x2="1509.187" y1="118.9766" y2="1594.1484"/></g><g><title>Stripe .Checkout.</title><rect fill="#000000" fill-opacity="0.00000" height="1475.1719" width="8" x="1685.4966" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1689.1211" x2="1689.1211" y1="118.9766" y2="1594.1484"/></g><g><title>Database</title><rect fill="#000000" fill-opacity="0.00000" height="1475.1719" width="8" x="1888.1172" y="118.9766"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1891.8979" x2="1891.8979" y1="118.9766" y2="1594.1484"/></g><g class="participant participant-head" data-participant="Owner"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.8799" x="5" y="116.0234">Owner</text><ellipse cx="29.9399" cy="50.9883" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M29.9399,58.9883 L29.9399,85.9883 M16.9399,66.9883 L42.9399,66.9883 M29.9399,85.9883 L16.9399,100.9883 M29.9399,85.9883 L42.9399,100.9883" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Owner"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.8799" x="5" y="1606.6836">Owner</text><ellipse cx="29.9399" cy="1618.1367" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M29.9399,1626.1367 L29.9399,1653.1367 M16.9399,1634.1367 L42.9399,1634.1367 M29.9399,1653.1367 L16.9399,1668.1367 M29.9399,1653.1367 L42.9399,1668.1367" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="FE"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111.5625" x="245.4063" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.0586" x="270.6582" y="91.5352">Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.5625" x="252.4063" y="108.0234">(Browser/App)</text></g><g class="participant participant-tail" data-participant="FE"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111.5625" x="245.4063" y="1593.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.0586" x="270.6582" y="1613.6836">Frontend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97.5625" x="252.4063" y="1630.1719">(Browser/App)</text></g><g class="participant participant-head" data-participant="API"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115.5547" x="785.2393" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.5918" x="812.2207" y="91.5352">HTTP API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.5547" x="792.2393" y="108.0234">(HTTPGateway)</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115.5547" x="785.2393" y="1593.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.5918" x="812.2207" y="1613.6836">HTTP API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.5547" x="792.2393" y="1630.1719">(HTTPGateway)</text></g><g class="participant participant-head" data-participant="SS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.6641" x="1331.5229" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.6641" x="1338.5229" y="108.0234">ServiceService</text></g><g class="participant participant-tail" data-participant="SS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.6641" x="1331.5229" y="1593.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.6641" x="1338.5229" y="1613.6836">ServiceService</text></g><g class="participant participant-head" data-participant="PS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.9111" x="1450.187" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.9111" x="1457.187" y="108.0234">PaymentService</text></g><g class="participant participant-tail" data-participant="PS"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.9111" x="1450.187" y="1593.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.9111" x="1457.187" y="1613.6836">PaymentService</text></g><g class="participant participant-head" data-participant="STR"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.751" x="1624.1211" y="87.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.751" x="1631.1211" y="108.0234">Stripe (Checkout)</text></g><g class="participant participant-tail" data-participant="STR"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.751" x="1624.1211" y="1593.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.751" x="1631.1211" y="1613.6836">Stripe (Checkout)</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94.4385" x="1844.8979" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.665" x="1860.7847" y="91.5352">Database</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.4385" x="1851.8979" y="108.0234">(Prisma/DB)</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94.4385" x="1844.8979" y="1593.1484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62.665" x="1860.7847" y="1613.6836">Database</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.4385" x="1851.8979" y="1630.1719">(Prisma/DB)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1959.3364" x="0" y="149.6318"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1959.3364" y1="149.6318" y2="149.6318"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1959.3364" y1="152.6318" y2="152.6318"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="98.6523" x="930.342" y="138.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="80.3677" x="936.342" y="155.5449">Assumption</text><path d="M533,177.2871 L533,232.2871 L1152,232.2871 L1152,187.2871 L1142,177.2871 L533,177.2871" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1142,177.2871 L1142,187.2871 L1152,187.2871 L1142,177.2871" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="598.6982" x="539" y="194.8555">This diagram shows the simplified user flow per request: on confirm both Service and Payment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="565.5127" x="539" y="210.166">(and the appropriate subservice) are created before redirecting to Stripe. (Implementation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="352.3394" x="539" y="225.4766">may instead create the service after payment webhook.)</text><g class="message" data-participant-1="Owner" data-participant-2="FE"><polygon fill="#181818" points="289.1875,255.5293,299.1875,259.5293,289.1875,263.5293,293.1875,259.5293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.9399" x2="295.1875" y1="259.5293" y2="259.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.1416" x="36.9399" y="254.7871">(already-authenticated) Select pet</text></g><g class="message" data-participant-1="FE" data-participant-2="API"><polygon fill="#181818" points="831.0166,284.8398,841.0166,288.8398,831.0166,292.8398,835.0166,288.8398" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="301.1875" x2="837.0166" y1="288.8398" y2="288.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278.5986" x="308.1875" y="284.0977">GET /pets/owner (optional) -&gt; show pet list</text></g><g class="message" data-participant-1="Owner" data-participant-2="FE"><polygon fill="#181818" points="289.1875,314.1504,299.1875,318.1504,289.1875,322.1504,293.1875,318.1504" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.9399" x2="295.1875" y1="318.1504" y2="318.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247.2476" x="36.9399" y="313.4082">Select service type (cservice | mservice)</text></g><g class="message" data-participant-1="FE" data-participant-2="API"><polygon fill="#181818" points="831.0166,343.4609,841.0166,347.4609,831.0166,351.4609,835.0166,347.4609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="301.1875" x2="837.0166" y1="347.4609" y2="347.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323.7368" x="308.1875" y="342.7188">GET /services/staff?serviceType=... (show staff list)</text></g><g class="message" data-participant-1="API" data-participant-2="SS"><polygon fill="#181818" points="1373.855,372.7715,1383.855,376.7715,1373.855,380.7715,1377.855,376.7715" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="843.0166" x2="1379.855" y1="376.7715" y2="376.7715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.4961" x="850.0166" y="372.0293">FindAvailableStaff(serviceType, date)</text></g><g class="message" data-participant-1="SS" data-participant-2="DB"><polygon fill="#181818" points="1880.1172,402.082,1890.1172,406.082,1880.1172,410.082,1884.1172,406.082" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1385.855" x2="1886.1172" y1="406.082" y2="406.082"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.9502" x="1392.855" y="401.3398">query staff availability</text></g><g class="message" data-participant-1="DB" data-participant-2="SS"><polygon fill="#181818" points="1396.855,431.3926,1386.855,435.3926,1396.855,439.3926,1392.855,435.3926" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1390.855" x2="1891.1172" y1="435.3926" y2="435.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.4238" x="1402.855" y="430.6504">available staff list</text></g><g class="message" data-participant-1="SS" data-participant-2="API"><polygon fill="#181818" points="854.0166,460.7031,844.0166,464.7031,854.0166,468.7031,850.0166,464.7031" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="848.0166" x2="1384.855" y1="464.7031" y2="464.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87.3057" x="860.0166" y="459.9609">available staff</text></g><g class="message" data-participant-1="API" data-participant-2="FE"><polygon fill="#181818" points="312.1875,490.0137,302.1875,494.0137,312.1875,498.0137,308.1875,494.0137" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="306.1875" x2="842.0166" y1="494.0137" y2="494.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.1157" x="318.1875" y="489.2715">show available staff</text></g><g class="message" data-participant-1="Owner" data-participant-2="FE"><polygon fill="#181818" points="289.1875,519.3242,299.1875,523.3242,289.1875,527.3242,293.1875,523.3242" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.9399" x2="295.1875" y1="523.3242" y2="523.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69.1069" x="36.9399" y="518.582">Select staff</text></g><g class="message" data-participant-1="FE" data-participant-2="API"><polygon fill="#181818" points="831.0166,548.6348,841.0166,552.6348,831.0166,556.6348,835.0166,552.6348" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="301.1875" x2="837.0166" y1="552.6348" y2="552.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334.623" x="308.1875" y="547.8926">GET /services/staff/{staffID}/time?startDate=... (JWT)</text></g><g class="message" data-participant-1="API" data-participant-2="SS"><polygon fill="#181818" points="1373.855,577.9453,1383.855,581.9453,1373.855,585.9453,1377.855,581.9453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="843.0166" x2="1379.855" y1="581.9453" y2="581.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279.0049" x="850.0166" y="577.2031">FindBusyTimeSlot(serviceType, staffID, date)</text></g><g class="message" data-participant-1="SS" data-participant-2="DB"><polygon fill="#181818" points="1880.1172,607.2559,1890.1172,611.2559,1880.1172,615.2559,1884.1172,611.2559" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1385.855" x2="1886.1172" y1="611.2559" y2="611.2559"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.8979" x="1392.855" y="606.5137">query busy slots for staff</text></g><g class="message" data-participant-1="DB" data-participant-2="SS"><polygon fill="#181818" points="1396.855,636.5664,1386.855,640.5664,1396.855,644.5664,1392.855,640.5664" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1390.855" x2="1891.1172" y1="640.5664" y2="640.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.7544" x="1402.855" y="635.8242">busy time slots</text></g><g class="message" data-participant-1="SS" data-participant-2="API"><polygon fill="#181818" points="854.0166,665.877,844.0166,669.877,854.0166,673.877,850.0166,669.877" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="848.0166" x2="1384.855" y1="669.877" y2="669.877"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.7544" x="860.0166" y="665.1348">busy time slots</text></g><g class="message" data-participant-1="API" data-participant-2="FE"><polygon fill="#181818" points="312.1875,695.1875,302.1875,699.1875,312.1875,703.1875,308.1875,699.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="306.1875" x2="842.0166" y1="699.1875" y2="699.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.5142" x="318.1875" y="694.4453">show available times</text></g><g class="message" data-participant-1="Owner" data-participant-2="FE"><polygon fill="#181818" points="289.1875,724.498,299.1875,728.498,289.1875,732.498,293.1875,728.498" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="29.9399" x2="295.1875" y1="728.498" y2="728.498"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.604" x="36.9399" y="723.7559">Select timeslot and Confirm booking</text></g><g class="message" data-participant-1="FE" data-participant-2="API"><polygon fill="#181818" points="831.0166,753.8086,841.0166,757.8086,831.0166,761.8086,835.0166,757.8086" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="301.1875" x2="837.0166" y1="757.8086" y2="757.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="517.8291" x="308.1875" y="753.0664">POST /services/confirm (payload: pet_id, staff_id, service_type, reserve_start/end)</text></g><path d="M848,770.8086 L848,825.8086 L1473,825.8086 L1473,780.8086 L1463,770.8086 L848,770.8086" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1463,770.8086 L1463,780.8086 L1473,780.8086 L1463,770.8086" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="566.1348" x="854" y="788.377">On confirm: create Payment with status=UNPAID and return Stripe checkout link to client.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="604.2017" x="854" y="803.6875">After successful Stripe payment (webhook), update Payment to PAID and then create the Service</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="489.436" x="854" y="818.998">and the appropriate subservice (CService or MService) linked to that payment.</text><g class="message" data-participant-1="API" data-participant-2="DB"><polygon fill="#181818" points="1880.1172,849.0508,1890.1172,853.0508,1880.1172,857.0508,1884.1172,853.0508" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="843.0166" x2="1886.1172" y1="853.0508" y2="853.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.4609" x="850.0166" y="848.3086">create Payment (status=UNPAID)</text></g><g class="message" data-participant-1="DB" data-participant-2="API"><polygon fill="#181818" points="854.0166,878.3613,844.0166,882.3613,854.0166,886.3613,850.0166,882.3613" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="848.0166" x2="1891.1172" y1="882.3613" y2="882.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.3213" x="860.0166" y="877.6191">payment (payment_id, price)</text></g><g class="message" data-participant-1="API" data-participant-2="PS"><polygon fill="#181818" points="1497.6426,907.6719,1507.6426,911.6719,1497.6426,915.6719,1501.6426,911.6719" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="843.0166" x2="1503.6426" y1="911.6719" y2="911.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="627.9165" x="850.0166" y="906.9297">StripeCreatePrice(metadata: payment_id, owner_id, pet_id, staff_id, service_type, reserve_start/end)</text></g><g class="message" data-participant-1="PS" data-participant-2="STR"><polygon fill="#181818" points="1677.4966,936.9824,1687.4966,940.9824,1677.4966,944.9824,1681.4966,940.9824" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1509.6426" x2="1683.4966" y1="940.9824" y2="940.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.854" x="1516.6426" y="936.2402">Create Checkout Session</text></g><g class="message" data-participant-1="STR" data-participant-2="PS"><polygon fill="#181818" points="1520.6426,966.293,1510.6426,970.293,1520.6426,974.293,1516.6426,970.293" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1514.6426" x2="1688.4966" y1="970.293" y2="970.293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.7866" x="1526.6426" y="965.5508">checkout_url</text></g><g class="message" data-participant-1="PS" data-participant-2="API"><polygon fill="#181818" points="854.0166,995.6035,844.0166,999.6035,854.0166,1003.6035,850.0166,999.6035" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="848.0166" x2="1508.6426" y1="999.6035" y2="999.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65.6729" x="860.0166" y="994.8613">stripe_link</text></g><g class="message" data-participant-1="API" data-participant-2="FE"><polygon fill="#181818" points="312.1875,1024.9141,302.1875,1028.9141,312.1875,1032.9141,308.1875,1028.9141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="306.1875" x2="842.0166" y1="1028.9141" y2="1028.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.394" x="318.1875" y="1024.1719">201 Created { payment_id, stripe_link }</text></g><g class="message" data-participant-1="FE" data-participant-2="STR"><polygon fill="#181818" points="1677.4966,1054.2246,1687.4966,1058.2246,1677.4966,1062.2246,1681.4966,1058.2246" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="301.1875" x2="1683.4966" y1="1058.2246" y2="1058.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.6411" x="308.1875" y="1053.4824">Redirect client to Stripe checkout</text></g><g class="message" data-participant-1="STR" data-participant-2="STR"><line style="stroke:#181818;stroke-width:1;" x1="1689.4966" x2="1731.4966" y1="1087.5352" y2="1087.5352"/><line style="stroke:#181818;stroke-width:1;" x1="1731.4966" x2="1731.4966" y1="1087.5352" y2="1100.5352"/><line style="stroke:#181818;stroke-width:1;" x1="1690.4966" x2="1731.4966" y1="1100.5352" y2="1100.5352"/><polygon fill="#181818" points="1700.4966,1096.5352,1690.4966,1100.5352,1700.4966,1104.5352,1696.4966,1100.5352" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188.6206" x="1696.4966" y="1082.793">Customer completes payment</text></g><g class="message" data-participant-1="STR" data-participant-2="API"><polygon fill="#181818" points="854.0166,1125.8457,844.0166,1129.8457,854.0166,1133.8457,850.0166,1129.8457" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="848.0166" x2="1688.4966" y1="1129.8457" y2="1129.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310.4321" x="860.0166" y="1125.1035">POST /stripe/service (payment_intent succeeded)</text></g><g class="message" data-participant-1="API" data-participant-2="PS"><polygon fill="#181818" points="1497.6426,1155.1563,1507.6426,1159.1563,1497.6426,1163.1563,1501.6426,1159.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="843.0166" x2="1503.6426" y1="1159.1563" y2="1159.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249.1582" x="850.0166" y="1154.4141">GetMethodAndPaydate(payment_intent)</text></g><g class="message" data-participant-1="PS" data-participant-2="PS"><line style="stroke:#181818;stroke-width:1;" x1="1509.6426" x2="1551.6426" y1="1188.4668" y2="1188.4668"/><line style="stroke:#181818;stroke-width:1;" x1="1551.6426" x2="1551.6426" y1="1188.4668" y2="1201.4668"/><line style="stroke:#181818;stroke-width:1;" x1="1510.6426" x2="1551.6426" y1="1201.4668" y2="1201.4668"/><polygon fill="#181818" points="1520.6426,1197.4668,1510.6426,1201.4668,1520.6426,1205.4668,1516.6426,1201.4668" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.9868" x="1516.6426" y="1183.7246">parse method, paydate</text></g><g class="message" data-participant-1="API" data-participant-2="PS"><polygon fill="#181818" points="1497.6426,1226.7773,1507.6426,1230.7773,1497.6426,1234.7773,1501.6426,1230.7773" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="843.0166" x2="1503.6426" y1="1230.7773" y2="1230.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="342.0752" x="850.0166" y="1226.0352">UpdateByID(payment_id, {status:PAID, type, pay_date})</text></g><g class="message" data-participant-1="PS" data-participant-2="DB"><polygon fill="#181818" points="1880.1172,1256.0879,1890.1172,1260.0879,1880.1172,1264.0879,1884.1172,1260.0879" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1509.6426" x2="1886.1172" y1="1260.0879" y2="1260.0879"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.3511" x="1516.6426" y="1255.3457">update payment status -&gt; PAID</text></g><g class="message" data-participant-1="DB" data-participant-2="PS"><polygon fill="#181818" points="1520.6426,1285.3984,1510.6426,1289.3984,1520.6426,1293.3984,1516.6426,1289.3984" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1514.6426" x2="1891.1172" y1="1289.3984" y2="1289.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.4746" x="1526.6426" y="1284.6563">updated payment</text></g><g class="message" data-participant-1="API" data-participant-2="SS"><polygon fill="#181818" points="1373.855,1314.709,1383.855,1318.709,1373.855,1322.709,1377.855,1318.709" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="843.0166" x2="1379.855" y1="1318.709" y2="1318.709"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="518.8384" x="850.0166" y="1313.9668">CreateService(createServiceRequest built from metadata + updatedPayment.PayID)</text></g><g class="message" data-participant-1="SS" data-participant-2="DB"><polygon fill="#181818" points="1880.1172,1344.0195,1890.1172,1348.0195,1880.1172,1352.0195,1884.1172,1348.0195" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1385.855" x2="1886.1172" y1="1348.0195" y2="1348.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223.2471" x="1392.855" y="1343.2773">create Service record (Service table)</text></g><path d="M1321.5229,1363.0195 L1383.6616,1363.0195 L1383.6616,1370.3301 L1373.6616,1380.3301 L1321.5229,1380.3301 L1321.5229,1363.0195" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="90.8867" style="stroke:#000000;stroke-width:1.5;" width="627.8135" x="1321.5229" y="1363.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="1336.5229" y="1376.5879">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="148.9995" x="1398.6616" y="1375.6543">[service_type == cservice]</text><g class="message" data-participant-1="SS" data-participant-2="DB"><polygon fill="#181818" points="1880.1172,1397.6406,1890.1172,1401.6406,1880.1172,1405.6406,1884.1172,1401.6406" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1385.855" x2="1886.1172" y1="1401.6406" y2="1401.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289.6182" x="1392.855" y="1396.8984">create CService (caretaker-specific subrecord)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="1321.5229" x2="1949.3364" y1="1410.6406" y2="1410.6406"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153.812" x="1326.5229" y="1421.2754">[service_type == mservice]</text><g class="message" data-participant-1="SS" data-participant-2="DB"><polygon fill="#181818" points="1880.1172,1441.9063,1890.1172,1445.9063,1880.1172,1449.9063,1884.1172,1445.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1385.855" x2="1886.1172" y1="1445.9063" y2="1445.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.1343" x="1392.855" y="1441.1641">create MService (medical-specific subrecord)</text></g><g class="message" data-participant-1="DB" data-participant-2="SS"><polygon fill="#181818" points="1396.855,1478.2168,1386.855,1482.2168,1396.855,1486.2168,1392.855,1482.2168" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1390.855" x2="1891.1172" y1="1482.2168" y2="1482.2168"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.3911" x="1402.855" y="1477.4746">service + subservice created</text></g><g class="message" data-participant-1="SS" data-participant-2="API"><polygon fill="#181818" points="854.0166,1507.5273,844.0166,1511.5273,854.0166,1515.5273,850.0166,1511.5273" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="848.0166" x2="1384.855" y1="1511.5273" y2="1511.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.2568" x="860.0166" y="1506.7852">service, subservice</text></g><g class="message" data-participant-1="API" data-participant-2="FE"><polygon fill="#181818" points="312.1875,1536.8379,302.1875,1540.8379,312.1875,1544.8379,308.1875,1540.8379" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="306.1875" x2="842.0166" y1="1540.8379" y2="1540.8379"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="412.1533" x="318.1875" y="1536.0957">redirect back to booking page (payment success, service created)</text></g><path d="M306,1553.8379 L306,1578.8379 L902,1578.8379 L902,1563.8379 L892,1553.8379 L306,1553.8379" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M892,1553.8379 L892,1563.8379 L902,1563.8379 L892,1553.8379" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="575.4785" x="312" y="1571.4063">Final state: Payment status = PAID; Service and subservice exist and are linked to payment.</text><!--SRC=[bLRTRkis3BxtKn3doi5fassN6RA3f6cx3kWQr3dOpO10iPL6g6rv4jqkw2cmXzWJxab6wiUrawx0hc95v4VguqTAgB2KiD3wKTKFa4dpf789__prDrXLDQNQALd0hjJFII9or0RkdcjfG5Z_aJJ2eCfL8sg4JrT6roZhulSwNHZzRAMPp9jcz8dDhow7jZ-lrokOhsx8bZ-l1SfdSV2szFVGEEGLVfnDbWrDLk9GoHhx9giZamoDQYIa5tkPF-eMVR1iVJyqMmeKMs4bPROoobPYibnuq-KYIMOpc5lRLWqgNSDibjGQ9UWd8eNJ1bZlbOL2YGSZAh1xeW5mB_jqjaICunGQ-Z3oZrPQd0B1vRhUALF1LkE-AuQe2mYd8_YKbmmeciRenYWY3coxjTvw1C98o8salmlOofscfP65CZ97BZ5gy3oC8RsXb2JZ2ZuCWLVY0AgsA4KHC7pkCPCTKiADpmMUvNPFkXcF4YevC0r9ujLn_XELUqgfbeHH7Cv5IoWrCSn9ZUXW9IL3XyVawfADYRWfN5-kOKB_sObs8Abs58jon2PC97j0gImUnGbuCKiyS97pkFm6LUJc95pOi1EBOhVx4fPh0fYDnqIGY-hsNDnHGgwCa6LJk59rCNyIgXJRKcPia_Rypw2WmuwIB6FxvM8AL6Lp2632-wbIuI5PBk0yO8g8rmlg86BMHmO-dq23I_ROu7sctDR7P4nUtC_DydM2gf9VQ6MGMYCmyyjlwnCs5gqzhCasApKEkGXG_qNAbXp1afS5qcj8hqUBs-SilD60aUEz3nXXA_i-8swB_5spNNHTwAPYdwZLNTPdAlPhIZrHQb5CMQ8RLOGJ-ozll477X96ybXj7vuGQPvJu2MBKmnv1xy8KkUk6mJHsuYhsdQBXGFxOsjdNNrVpcwNBsaXiJHsQ6_8muqX2zICtVLugSXuJzDnriMrpEe7TjMLqYNsTXiOUdK7R5Ft81DE5uuxkpuWmhGZ_um55upSEDYhrRHR75kT94uj2u5vWJ6RScor1RIoR8qRI0HkZA1rNiUvKuSFLXBBYSH0XLwGnJyA50rxnTbf957HyqM4uLpUSFCZ_B_NA2Pzkd2duI13l8kBFMXx2jEcIvvnY4JUjAPrlF9HroMwOiu7WV_Zk-m1SmCiWxPu7l2P1qYwH-t0v18MyNH1TU9zJpBkrg2iIKAxvza1fOvmaslKxnI5DkjftAV4x0Rq8PK6NGhyKrn9l9UvrCQyBAZ5ByCWnCidMT7TR2PLpEEDSsBuFzzM9U76uMGuqyE95CsN9d84l6UrlsFWr1c2nXIQ8Gl9k3fmyezOua3SitlZepKTVbQ3sDE-lxlq3W2QPAX5sHbSGfGUV8sYG-fX-MU5l4pIqGkmfggGs1QHnZJpvHeaeSQ1EUhX0l26fPG5E0BikJNDwKQ1ubERSDZAd9qpExUm3qTrVMda2NNq8VTj1LwIzN9Jl0zT5_mw84lhSdoNXdJEu4CBUMSyk6JH9V0t1LkHkD8OvJtLxU9De791TLyTW9mERNhR0zvyedJRaj9jBGIepfvGV1m-wtY7adtJBkp_vwVOs1qz7uBy0]--></g></svg>