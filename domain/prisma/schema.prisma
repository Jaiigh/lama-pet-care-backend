generator db {
  provider = "go run github.com/steebchen/prisma-client-go"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  show_id          Int      @default(autoincrement()) @unique
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  updated_at       DateTime @updatedAt @db.Timestamptz(6)
  email            String
  password         String
  role             role     @default(owner)
  name             String
  birthdate        DateTime @db.Date
  telephone_number String   @db.VarChar(10)
  address          String
  profile_image    String?

  Caretaker Caretaker?
  Doctor    Doctor?
  Owner     Owner?

  @@unique([email, role], name: "Users_email_role_key")
  @@unique([telephone_number, role], name: "Users_telephone_number_role_key")
  @@index([email])
}

model Caretaker {
  user_id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  specialties        String?
  start_working_time DateTime @default(dbgenerated("'00:00:00'::time without time zone")) @db.Time(6)
  end_working_time   DateTime @default(dbgenerated("'00:00:00'::time without time zone")) @db.Time(6)
  rating             Decimal? @db.Decimal(2, 1)

  Users    Users      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  Cservice Cservice[]
  Leaveday Leaveday[]
}

model Cservice {
  score   Int
  comment String?
  SID     String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  CID     String  @db.Uuid

  Caretaker Caretaker @relation(fields: [CID], references: [user_id], onDelete: Cascade)
  Service   Service   @relation(fields: [SID], references: [SID], onDelete: Cascade)
}

model Doctor {
  user_id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  license_number     String   @unique
  start_date         DateTime @default(dbgenerated("'0001-01-01'::date")) @db.Date
  start_working_time DateTime @default(dbgenerated("'00:00:00'::time without time zone")) @db.Time(6)
  end_working_time   DateTime @default(dbgenerated("'00:00:00'::time without time zone")) @db.Time(6)

  Users    Users      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  Mservice Mservice[]
  Leaveday Leaveday[]
}

model Medicine {
  mediname String
  SID      String @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  Service Service @relation(fields: [SID], references: [SID], onDelete: Cascade)

  @@id([mediname, SID])
}

model Mservice {
  disease String
  SID     String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  DID     String? @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  Doctor  Doctor? @relation(fields: [DID], references: [user_id], onDelete: Cascade)
  Service Service @relation(fields: [SID], references: [SID], onDelete: Cascade)
}

model Owner {
  user_id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  total_spending Decimal @default(0) @db.Decimal(12, 2)

  Payment Payment[]
  Pet     Pet[]
  Service Service[]

  Users Users @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Payment {
  type     String?
  price  Int
  status   payment_status
  pay_date DateTime?      @db.Date
  PAYID    String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  OID      String         @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  Owner   Owner     @relation(fields: [OID], references: [user_id], onDelete: Cascade)
  Service Service[]
}

model Pet {
  breed     String?
  name      String?
  birthdate DateTime @db.Date
  weight    Decimal  @db.Decimal(5, 2)
  kind      String
  sex       pet_sex
  OID       String   @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  PETID     String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  Owner   Owner     @relation(fields: [OID], references: [user_id], onDelete: Cascade)
  Service Service[]
}

model Service {
  show_id          Int      @default(autoincrement()) @unique
  status service_status
  rdate_start  DateTime       @db.Timestamptz(6)
  rdate_end  DateTime       @db.Timestamptz(6)
  SID    String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  PETID  String         @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  PAYID  String         @default(dbgenerated("gen_random_uuid()")) @db.Uuid @unique
  OID    String         @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  Cservice Cservice?
  Medicine Medicine[]
  Mservice Mservice?
  Owner    Owner      @relation(fields: [OID], references: [user_id], onDelete: Cascade)
  Payment  Payment    @relation(fields: [PAYID], references: [PAYID], onDelete: Cascade)
  Pet      Pet        @relation(fields: [PETID], references: [PETID], onDelete: Cascade)
}

model Leaveday {
  id       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  CID      String?  @db.Uuid
  DID      String?  @db.Uuid
  leaveday DateTime @db.Date

  Caretaker Caretaker? @relation(fields: [CID], references: [user_id], onDelete: Cascade)
  Doctor    Doctor?    @relation(fields: [DID], references: [user_id], onDelete: Cascade)

  @@unique([CID, leaveday], name: "Leaveday_CID_leaveday_key")
  @@unique([DID, leaveday], name: "Leaveday_DID_leaveday_key")
  @@index([leaveday])
}

enum payment_status {
  UNPAID
  PAID
}

enum pet_sex {
  male
  female
  unknown
}

enum service_status {
  wait
  ongoing
  finish
}

enum role {
  admin
  owner
  doctor
  caretaker
}
